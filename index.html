<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>落書き帳</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }

        canvas {
            touch-action: none;
            display: block;
            width: 100%;
            height: 100%;
        }

        button {
            position: fixed;
            bottom: 10px;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 8px;
            border: none;
            background: #444;
            color: white;
            margin: 0 5px;
        }

        #undo {
            left: 10px;
        }

        #clear {
            right: 10px;
        }
    </style>
</head>

<body>
    <button id="clear">クリア</button>
    <button id="undo">一つ戻る</button>
    <canvas id="board"></canvas>
    <script>
        const canvas = document.getElementById("board");
        const ctx = canvas.getContext("2d");
        resize();
        drawPlaceholder();

        const history = [];

        function drawPlaceholder() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = "bold 32px sans-serif";
            ctx.fillStyle = "#aaa";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("落書き帳", canvas.width / 2, canvas.height / 2);
        }

        function save() {
            history.push(canvas.toDataURL());
        }

        canvas.addEventListener("touchstart", () => save());

        document.getElementById("undo").addEventListener("click", () => {
            if (history.length === 0) return;
            const img = new Image();
            img.src = history.pop();
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            };
        });

        document.getElementById("clear").addEventListener("click", () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            history.length = 0;
            drawPlaceholder();
        });


        let drawing = false;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener("resize", resize);

        function start(e) {
            drawing = true;
            if (history.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            ctx.beginPath();
            ctx.moveTo(e.touches[0].clientX, e.touches[0].clientY);
        }

        function draw(e) {
            if (!drawing) return;
            ctx.lineTo(e.touches[0].clientX, e.touches[0].clientY);
            ctx.stroke();
        }

        function end() {
            drawing = false;
            ctx.closePath();
        }

        canvas.addEventListener("touchstart", start);
        canvas.addEventListener("touchmove", draw);
        canvas.addEventListener("touchend", end);
    </script>
</body>

</html>